# Web Server Configuration
web_server:
  type: "nginx"  # or "apache"
  log_path: "/var/log/nginx/access.log"
  error_log_path: "/var/log/nginx/error.log"
  log_format: "detailed"
  
# Application Configuration
applications:
  app1:
    name: "Juice Shop"
    type: "nodejs"
    port: 8080
    path: "applications/app1-juice-shop"
    log_path: "/var/log/nginx/access.log"
    startup: "npm start"
  app2:
    name: "WebGoat"
    type: "java"
    port: 8081
    path: "applications/app2-webgoat"
    log_path: "/var/log/nginx/access.log"
    startup: "java -jar webgoat-container/target/webgoat-*.jar --server.port=8081"
  app3:
    name: "DVWA"
    type: "php"
    port: 8082
    path: "applications/app3-dvwa"
    log_path: "/var/log/nginx/access.log"
    startup: "php -S localhost:8082"

# Data Paths
data:
  raw_logs: "data/raw"
  processed: "data/processed"
  normalized: "data/normalized"
  training: "data/training"
  validation: "data/validation"
  test: "data/test"

# Model Configuration
model:
  checkpoint_dir: "models/checkpoints"
  vocabulary_dir: "models/vocabularies"
  deployed_dir: "models/deployed"

# WAF Service
waf_service:
  host: "0.0.0.0"
  port: 8000
  workers: 4
  timeout: 5.0
  model_path: "models/checkpoints/best_model.pt"
  vocab_path: "models/vocabularies/http_vocab.json"
  threshold: 0.5

# Log Ingestion Configuration
ingestion:
  batch:
    chunk_size: 1000
    max_lines: null  # null = no limit
    skip_lines: 0
  
  streaming:
    poll_interval: 0.1
    follow: true
    buffer_size: 10000
  
  retry:
    max_retries: 3
    initial_delay: 1.0
    max_delay: 60.0
    exponential_base: 2.0

# Training Configuration
training:
  model:
    architecture: "distilbert"
    hidden_size: 768
    num_layers: 6
    num_heads: 12
    dropout: 0.1
    max_length: 512
  
  training:
    num_epochs: 10
    batch_size: 32
    learning_rate: 2e-5
    weight_decay: 0.01
    gradient_clip: 1.0
  
  data:
    train_split: 0.8
    val_split: 0.2
    max_samples: null  # null = use all
  
  anomaly:
    threshold: 0.5
    score_range: [0.0, 1.0]
  
  loss:
    type: "weighted_mse"  # Options: "mse", "weighted_mse", "focal", "contrastive", "combined"
    false_positive_weight: 2.0  # For weighted_mse

# Integration Configuration
integration:
  waf_service:
    host: "0.0.0.0"
    port: 8000
    workers: 4
    timeout: 5.0
    model_path: "models/checkpoints/best_model.pt"
    vocab_path: "models/vocabularies/http_vocab.json"
    threshold: 0.5

  web_server:
    type: "nginx"  # or "apache"
    integration_method: "reverse_proxy"  # or "module", "sidecar"
    block_on_anomaly: true
    fail_open: true  # Allow requests if WAF service unavailable

  logging:
    log_anomalies: true
    log_all_requests: false
    log_file: "logs/waf_detections.log"
  
  early_stopping:
    enabled: true
    patience: 5
    metric: "f1_score"  # Options: "f1_score", "tpr", "fpr", "precision", "recall", "val_loss"
    min_delta: 0.001
  
  data_augmentation:
    enabled: true
    augmentation_factor: 1  # Number of augmented versions per sample

# Evaluation Configuration
evaluation:
  metrics: ["tpr", "fpr", "precision", "recall", "f1", "roc_auc"]
  test_split: 0.1
  optimize_threshold: true
  target_fpr: 0.01
  threshold_method: "f1_maximize"  # Options: "f1_maximize", "target_fpr", "roc_optimal"
  use_malicious_payloads: true
  report_dir: "reports"

# API Server Configuration
api_server:
  host: "0.0.0.0"
  port: 3001
  workers: 4
  database:
    url: "sqlite:///./data/waf_dashboard.db"
  websocket:
    enabled: true
    ping_interval: 30
  data_retention:
    metrics_days: 30
    traffic_days: 7
    alerts_days: 90
    threats_days: 90
  cors_origins: ["http://localhost:3000", "http://localhost:3001"]
  log_ingestion:
    enabled: true
    log_path: "/var/log/nginx/access.log"  # Update with your log path
